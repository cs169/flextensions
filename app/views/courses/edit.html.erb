<%= render "layouts/sidebar" %>
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <%= render "courses/course_title" %>
            <ul class="nav nav-pills mb-4 justify-content-center" id="courses-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="course-default-tab" data-bs-toggle="pill" data-bs-target="#course-default" type="button" role="tab" aria-controls="course-default" aria-selected="false">General Settings</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="course-email-tab" data-bs-toggle="pill" data-bs-target="#course-email" type="button" role="tab" aria-controls="course-email" aria-selected="true">Email Settings</button>
                </li>
            </ul>
            <%= form_with(model: @course.course_setting || @course.build_course_setting, url: course_course_setting_path(@course), method: :patch) do |form| %>
                <div class="tab-content" id="courses-tabContent">
                    <div class="tab-pane fade show active" id="course-default" role="tabpanel" aria-labelledby="course-default-tab" tabindex="0">
                        <div class="card mb-4 shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="mb-0">Extension Request Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2 row">
                                    <div class="col-12 form-check form-switch ms-3">
                                        <%= form.check_box :enable_student_requests, class: "form-check-input", role: "switch", id: "course-enable" %>
                                        <%= form.label :enable_student_requests, "Enable Students to request extensions", class: "form-check-label h5", for: "course-enable" %>
                                    </div>
                                </div>
                                
                                <div class="row mb-1">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <%= form.number_field :auto_approve_days, min: 1, step: 1, class: "form-control", placeholder: "number of days", id: "auto-approve-days" %>
                                            <%= form.label :auto_approve_days, "Auto approve within days", for: "auto-approve-days" %>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <%= form.number_field :auto_approve_dsp_days, min: 1, step: 1, class: "form-control", placeholder: "number of days", id: "auto-approve-dsp-days" %>
                                            <%= form.label :auto_approve_dsp_days, "Auto approve within days (DSP)", for: "auto-approve-dsp-days" %>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-floating mb-3">
                                            <%= form.number_field :max_auto_approve, min: 1, step: 1, class: "form-control", placeholder: "number", id: "max-auto-approve" %>
                                            <%= form.label :max_auto_approve, "Maximum requests to auto approve", for: "max-auto-approve" %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mb-4 shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="mb-0">Email Configuration</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2 row">
                                    <div class="col-12 form-check form-switch ms-3">
                                        <%= form.check_box :enable_emails, class: "form-check-input", role: "switch", id: "email-enable" %>
                                        <%= form.label :enable_emails, "Enable Email Notifications", class: "form-check-label h5", for: "email-enable" %>
                                    </div>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <%= form.email_field :reply_email, class: "form-control email-field", placeholder: "example@email.com", id: "reply-email" %>
                                    <%= form.label :reply_email, "Course Reply Email Address", for: "reply-email" %>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="course-email" role="tabpanel" aria-labelledby="course-email-tab" tabindex="0">
                        <div class="card mb-4 shadow-sm">
                            <div class="card-header bg-light">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Email Template</h5>
                                    <div>
                                        <button type="button" class="btn btn-secondary btn-sm" id="reset-template">Reset Template</button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="template-flash" class="mb-3"></div>
                                
                                <div class="mb-3">
                                    <label for="email-template-select" class="form-label mb-0 fw-bold">Template Type</label>
                                    <select class="form-select mb-3 email-field" id="email-template-select">
                                        <option value="default">Default Extension Template</option>
                                        <option value="ta_review">TA Review Required Template</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="email-subject" class="form-label fw-bold">Email Subject</label>
                                    <%= form.text_field :email_subject, class: "form-control email-field", id: "email-subject" %>
                                    <small class="text-muted">Use {{variable_name}} to insert dynamic values</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="email-template" class="form-label fw-bold">Email Body</label>
                                    <%= form.text_area :email_template, class: "form-control email-field", id: "email-template", rows: 10 %>
                                </div>
                                
                                <div class="mt-4">
                                    <div class="card border">
                                        <div class="card-header bg-light">
                                            <h6 class="mb-0">Available Variables</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <p class="mb-1 fw-bold">Student Information:</p>
                                                    <ul class="list-unstyled">
                                                        <li><code>{{student_name}}</code> - Full name of student</li>
                                                        <li><code>{{student_email}}</code> - Student's email</li>
                                                        <li><code>{{student_id}}</code> - Student's ID number</li>
                                                    </ul>
                                                </div>
                                                <div class="col-md-4">
                                                    <p class="mb-1 fw-bold">Course Information:</p>
                                                    <ul class="list-unstyled">
                                                        <li><code>{{course_name}}</code> - Course name</li>
                                                        <li><code>{{course_code}}</code> - Course code</li>
                                                        <li><code>{{assignment_name}}</code> - Assignment name</li>
                                                    </ul>
                                                </div>
                                                <div class="col-md-4">
                                                    <p class="mb-1 fw-bold">Extension Information:</p>
                                                    <ul class="list-unstyled">
                                                        <li><code>{{original_due_date}}</code> - Original due date</li>
                                                        <li><code>{{new_due_date}}</code> - New due date</li>
                                                        <li><code>{{extension_days}}</code> - Number of days extended</li>
                                                        <li><code>{{status}}</code> - Request status (Approved/Denied)</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="text-center mb-4">
                    <%= form.submit "Save Settings", class: "btn btn-success btn-md" %>
                </div>
            <% end %>
        </div>
    </div>
</div>
